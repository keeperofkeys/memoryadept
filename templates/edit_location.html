{% extends 'jace.html' %}

{% block content %}
<h1>Edit {{ location }}</h1>

<p>Select a location...</p>
<form id="locations">
  {% for loc in locations %}
  <input type="radio" name="chosen_location" id="cb{{ loc.id }}"{% if loc.name == selected_location.name %} checked="checked"{% endif %}><label for="cb{{ loc.id }}">{{ loc.name }}</label>
  {% endfor %}
</form>
<form action="" id="create-new">
<p>... or create a new one...</p>
<input name="new-location" id="new-location" type="text">
<button type="submit">Create</button>
</form>
{% endblock %}

{% block extrascript %}
  <script type="text/javascript">
  $('#create-new').on('submit', function(e) {
    e.preventDefault();
    $.ajax({
      url: '/create-location',
      method: 'post',
      data: {
        'new-location' : $('#new-location').val()
      },
      success: function(json) {
        if (json.location_id) {
          if (json.new === true) {
            // add to list
            var newHtml = '<input type="radio" name="chosen_location" id="cb' + json.location_id + '">';
            newHtml += '<label for="cb' + json.location_id + '">' + json.location_name + '</label>'
            $('#locations').append($(newHtml));
          } 
          $('#locations #cb' + json.location_id).prop('checked', true);

        } else {
          alert('fell over');
        }
      }
    });
  });
  </script>
{% endblock %}
